<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
<head>
<title>JANET 1.1 Release Notes</title>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#0000FF" VLINK="#000077" ALINK="#FF0000">

<font size="+1"><pre>
/*****************************************************************
 * Release Notes: Java Native Extensions (JANET) 1.1             *
 * 22 June 2003                                                  *
 *****************************************************************/</pre>
</font>

<p>
This document describes JANET tool version 1.1. You will find in this file:
    <ul>
      <li><a href="#install">Installation Instructions</a></li>
      <li><a href="#usage">How to use JANET?</a></li>
      <li><a href="#changelog">Change Log</a></li>
      <li><a href="#supported">Functionality supported in this release</a></li>
      <li><a href="#notsupported">Functionality not supported in this release</a></li>
      <li><a href="#bugs">Reporting bugs</a></li>
    </ul>
</p>

<h2><a name=install>Installation Instructions</a></h2>

<p>
To install JANET, simply download and decompress the file
<code>janet-1.1.zip</code> in a place convenient to you. The <code>janet</code>
directory will be created, along with following files and subdirectories:
<ul>
  <li><code>README</code> - general information
  <li><code>release-notes.html</code> - this document
  <li><code>license.html</code> - licensing information
  <li><code>lib/</code> - class files for JANET tool and utilities
  <li><code>doc/</code> - documentation (currently, for utility classes only)
  <li><code>bin/</code> - scripts to start JANET (currently, for UNIX only)
  <li><code>native/</code> -
     additional resources needed to build shared libraries from files generated by JANET
  <li><code>examples/</code> - example JANET source files
</ul>
</p>


<h2><a name=usage>How to use JANET?</a></h2>

<p>
JANET is a pure Java application. To use it, you must have a Java 2 Runtime Environment
installed. JANET executables are placed in the JAR file <code>lib/janet.jar</code>.
To start the translator, type:
</p>
<p>
<code>java -jar</code> <i>janet-jar-file</i> <code>[options] [source files]</code>
</p>

<p>
If you invoke JANET without any options or source files, it will display the list of
recognized command-line options.
</p>

<p>
If you are UNIX user, you may start the translator more conveniently using a shell script
<code>bin/janet</code>:
</p>
<p>
<code>janet [options] [source files]</code>
</p>

<p>
JANET translator creates a set of Java and C source files. You need to compile Java files
using your Java compiler. The C source files must be compiled into dynamically linked
library (or libraries). By default, mapping from source file names to library names is
is based on the package in which the classes are defined. If it is a named package,
JANET assumes that you create one dynamic library per each package. The library
name must match the package name with dots replaced by underscores.
For instance, the library for package com.foo would be libcom_foo.so under Linux and
com_foo.dll under Windows. If the classes are defined in default (unnamed) package,
create one library per class and name the library with the name of the class.
This default mapping can be overridden using the "-libname" command-line option
<strong>(new!)</strong>.
</p>

<p>
JANET does not directly provide support for the compilation of dynamic libraries,
as the process is platform-dependent. Some
<a href="http://java.sun.com/docs/books/tutorial/native1.1/stepbystep/step5.html">
instructions</a> are provided in the
<a href="http://java.sun.com/docs/books/tutorial/native1.1/index.html">JNI tutorial</a>.
You may also refer to the sample GNU makefile in the <code>examples</code> subdirectory.
Important things to remember when compiling your libraries are:
<UL>
<LI>Add the directory <code>janet/native/c/include</code> to the include path of
    your compiler.</LI>
<LI>Add the directory containing JNI header files (<code>jni.h</code> and <code>jni_md.h</code>)
    to the include path of your compiler. You will find that files
    in the &lt;JRE&gt;<code>/include</code> and &lt;JRE&gt;<code>/include</code>/<i>platform</i>,
    directories, where &lt;JRE&gt; denotes the location of your Java Runtime Environment.</LI>
<LI><strong>Important:</strong> Compile the file <code>janet/native/c/janet.c</code> into
    every dynamically linked library you create.
    This file serves as a small JANET runtime library.</LI>
</UL>
</p>

<p>
And finally, some general-purpose hints for using JANET:
<ul>
<li>Sometimes JANET parser is, unfortunately, not too user-friendly in regard to
reporting compilation errors. Often, the missing back-quote character may result in a
parse problem somewhere else in the source file.
The <code>-dumptree</code> option (which enables displaying parsing trees
for processed files) may be helpful to identify such errors.</li>
<li>Remember that embedded Java statements, such as a return statement or variable declaration,
    must end with semicolon. That is, write <code>`int i;`</code> rather than
    <code>`int i`;</code>.</li>
<li>NEVER ignore compiler warnings related to assignments from incompatible pointer type
    or implicit int/pointer conversion. These are usually indications of serious bugs.</li>
<li>Remember that even if using JANET, you are still programming in C. Write your code
    carefully, and do not crash JVM!</li>
</ul>
<p>

<h2><a name=changelog>Change Log</a></h2>

<h3>Version 1.1</h3>

<ul>
<li>Invocation syntax changed to be more <code>javac-alike</code>, and more user-friendly
    in general.</li>
<li>It is now possible to specify -classpath and -sourcepath as command-line parameters,
    allowing JANET to properly process sources dependent on external classes.</li>
<li>It is now possible to specify names of dynamic libraries. The libraries may be assigned
    to individual classes, or to groups of classes.</li>
<li>Output generation for file hierarchies now follows <code>javac</code> semantics.
    By default, output files are generated in the same directories as source files.
    This can be overridden by specifying the output directory; however, JANET will
    still maintain source hierarchy and it will create appropriate subdirectories
    as needed.</li>
</ul>

<h3>Version 1.0</h3>

Initial release

<h2><a name=supported>Functionality supported in this release</a></h2>

<p>
JANET allows for embedding native code inside Java source files.
That embedded native code may in turn contain embedded Java statements
and expressions, later translated by JANET into JNI function invocations.
Ideally, any valid Java expression should be recognized by the
translator. However, it is not yet the case - most of the expression types
are recognized and properly handled, but some of more sophisticated are not.
The full list of embeddable Java expressions and statements recognized and
handled by this version of JANET is given below:

<UL>
<LI>Blocks [<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/statements.doc.html#246838" target="_top">14.2</A>],</LI>
<LI>Local Variable Declaration Statements
    [<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/statements.doc.html#5920" target="_top">14.4</A>],
    except for those containing array initializers
    [<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/arrays.doc.html#11358" target="_top">10.6</A>],</LI>
<LI>Expression Statements
    [<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/statements.doc.html#5984" target="_top">14.8</A>], for all kind of recognized expressions,</LI>
<LI>The <code>return</code> Statement
    [<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/statements.doc.html#6767" target="_top">14.16</A>],
    preserving the semantics of <code>finally</code> clauses,</LI>
<LI>The <code>throw</code> Statement
    [<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/statements.doc.html#237350" target="_top">14.17</A>],</LI>
<LI>The <code>synchronized</code> Statement
    [<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/statements.doc.html#255769" target="_top">14.18</A>],</LI>
<LI>The <code>try</code> Statement
    [<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/statements.doc.html#79311" target="_top">14.19</A>],</LI>
<LI>Lexical Literals
    [<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/expressions.doc.html#224125" target="_top">15.8.1</A>],</LI>
<LI><code>this</code>
    [<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/expressions.doc.html#251519" target="_top">15.8.3</A>],</LI>
<LI>Parenthesized Expressions
    [<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/expressions.doc.html#236822" target="_top">15.8.5</A>],</LI>
<LI>Class Instance Creation Expressions
    [<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/expressions.doc.html#41147" target="_top">15.9</A>]
    for instantiation of non-inner classes, and excluding Anonymous Class Declarations
    [<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/expressions.doc.html#252986" target="_top">15.9.5</A>],</LI>
<LI>Array Creation Expressions
    [<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/expressions.doc.html#46168" target="_top">15.10</A>]
    without array initializers
    [<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/arrays.doc.html#11358" target="_top">10.6</A>],
     </LI>
<LI>Field Access Expressions
    [<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/expressions.doc.html#41267" target="_top">15.11</A>]
    for fields of non-inner classes,</LI>
<LI>Method Invocation Expressions
    [<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/expressions.doc.html#20448" target="_top">15.12</A>]
    for methods of non-inner classes,</LI>
<LI>Array Access Expressions
    [<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/expressions.doc.html#239587" target="_top">15.13</A>]
    for arrays of primitive types and objects of non-inner classes,</LI>
<LI>Cast Expressions
    [<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/expressions.doc.html#238146" target="_top">15.16</A>]
    for casting to primitive types and non-inner classes,</LI>
<LI>Multiplication
    [<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/expressions.doc.html#5036" target="_top">15.17.1</A>]
    and Division
    [<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/expressions.doc.html#5047" target="_top">15.17.2</A>]
    Operators (<code>*</code>, <code>/</code>),</LI>
<LI>Additive Operators for Numeric Types
    [<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/expressions.doc.html#13510" target="_top">15.18.2</A>]
    (<code>+</code>, <code>-</code>),</LI>
<LI>Relational Operators
    [<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/expressions.doc.html#40641" target="_top">15.20</A>]
    (<code>&lt;</code>, <code>&gt;</code>, <code>&lt;=</code>, <code>&gt;=</code>, <code>instanceof</code>),</LI>
<LI>Equality Operators
    [<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/expressions.doc.html#5192" target="_top">15.21</A>]
    (<code>==</code>, <code>!=</code>),</LI>
<LI>Simple Assignment Operator
    [<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/expressions.doc.html#5295" target="_top">15.26.1</A>].</LI>
</UL>
</p>

<p>
In addition, JANET introduces pointer-fetch operators (<code>&amp;</code> and <code>#&amp;</code>)
applicable to arrays and strings, and native-to-Java string conversion operator
<code>$(</code>...<code>)</code>.
Consult the documentation to learn more about that features.
</p>

<h2><a name=notsupported>Functionality <i>not</i> supported in this release</a></h2>

<p>
Limitations of the current version of JANET translator include:
<UL>
<LI>Lack of support for embedding native languages other than C.
    Note, however, that JANET introduces no syntactic restrictions on the embedded C
    code, because it does not perform its semantic analysis beyond simple block and
    comment detection. Therefore, your C code can still invoke non-C routines
    using common linking techniques.</LI>
<LI>Inner classes are not fully supported -
    native code may not appear inside inner classes and it may not refer to them. However,
    pure-Java inner classes, as well as other syntactic extensions introduced
    in Java 1.1, are recognized.</LI>
<LI>Certain kinds of Java expressions may not be embedded into native code.
    The detailed list is given below.</LI>
<LI>JANET translator does not recover from errors.
    The translation stops on the first parse or compile error encountered
    so no more than one error per a compilation run is reported.</LI>
</UL>
</p>

<p>
Java expression types that may not currently be embedded into
native code include:

<UL>
<LI>Class Literals
    [<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/expressions.doc.html#251530" target="_top">15.8.2</A>],</LI>
<LI>Postfix Expressions
    [<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/expressions.doc.html#36254" target="_top">15.14</A>]
    (<code>++</code>, <code>--</code>),</LI>
<LI>Unary Operators
    [<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/expressions.doc.html#4990" target="_top">15.15</A>]
    (<code>++</code>, <code>--</code>, <code>+</code>, <code>-</code>, <code>~</code>, <code>!</code>),</LI>
<LI>Remainder Operator
    [<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/expressions.doc.html#24956" target="_top">15.17.3</A>]
    (<code>%</code>),</LI>
<LI>String Concatenation Operator
    [<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/expressions.doc.html#39990" target="_top">15.18.1</A>]
    (<code>+</code>),</LI>
<LI>Shift Operators
    [<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/expressions.doc.html#5121" target="_top">15.19</A>]
    (<code>&lt;&lt;</code>, <code>&gt;&gt;</code>, <code>&gt;&gt;&gt;</code>),</LI>
<LI>Bitwise and Logical Operators
    [<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/expressions.doc.html#5228" target="_top">15.22</A>]
    (<code>&amp;</code>, <code>^</code>, <code>|</code>),</LI>
<LI>Conditional-And Operator <code>&amp;&amp;</code>
    [<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/expressions.doc.html#5247" target="_top">15.23</A>],</LI>
<LI>Conditional-Or Operator <code>||</code>
    [<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/expressions.doc.html#54532" target="_top">15.24</A>],</LI>
<LI>Conditional Operator <code>?:</code>
    [<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/expressions.doc.html#290293" target="_top">15.25</A>],</LI>
<LI>Compound Assignment Operators
    [<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/expressions.doc.html#5304" target="_top">15.26.2</A>]
    (<code>*=</code>, <code>/=</code>, <code>%=</code>, <code>+=</code>, <code>-=</code>, <code>&lt;&lt;=</code>, <code>&gt;&gt;=</code>,
     <code>&gt;&gt;&gt;=</code>, <code>&amp;</code>, <code>^=</code>, <code>|=</code>),</LI>
<LI>Array initializers
    [<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/arrays.doc.html#11358" target="_top">10.6</A>],
		for both Local Variable Declaration Statements
    [<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/statements.doc.html#5920" target="_top">14.4</A>]
    and Array Creation Expressions
    [<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/expressions.doc.html#46168" target="_top">15.10</A>],</LI>
<LI>Expressions related to inner classes:
    Qualified <code>this</code>
    [<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/expressions.doc.html#251603" target="_top">15.8.4</A>],
    Class Instance Creation Expressions
    [<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/expressions.doc.html#41147" target="_top">15.9</A>],
    Field Access Expressions
    [<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/expressions.doc.html#41267" target="_top">15.11</A>],
    Method Invocation Expressions
    [<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/expressions.doc.html#20448" target="_top">15.12</A>],
    Array Access Expressions
    [<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/expressions.doc.html#239587" target="_top">15.13</A>],
    and Cast Expressions
    [<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/expressions.doc.html#238146" target="_top">15.16</A>].</LI>
</UL>
</p>

<p>
Most of that expressions are easy to substitute by other constructs. For instance:
<UL>
<LI>Appropriate native operators may be used instead of Java operators.</LI>
<LI>String concatenation may be realized with the expression
<code>new&nbsp;StringBuffer().</code><code>append(</code>...<code>).</code>...<code>.toString()</code>.</LI>
<LI>Compound assignment of the form <code>x </code><i>op</i><code>= y</code>
    may be substituted by the operation
    <code>x = x </code> <i>op</i><code> y</code>.</LI>
<LI>Array initialization may be delegated to a private Java method invoked through callback.</LI>
</UL>

Lack of support for inner classes is probably the most serious limitation, but I believe it may
be worked around as well.
Note that it is never recommended to use native methods in anonymous inner classes
[<A HREF="http://java.sun.com/docs/books/jls/second_edition/html/expressions.doc.html#252986" target="_top">15.9.5</A>],
since the internal naming convention for anonymous classes is not defined in
<A HREF="http://java.sun.com/docs/books/jls/" target="_top">Java Language</A>
or
<A HREF="http://java.sun.com/docs/books/vmspec/" target="_top">Virtual Machine</A>
specifications.
</p>

<h2><a name=bugs>Reporting bugs</a></h2>

<p>
As any other software, JANET may likely contain bugs. If you find one,
please report it to help to improve quality of JANET. To submit a bug, please use
<a href="https://sourceforge.net/tracker/?func=add&group_id=42947&atid=434651" target=_blank>
sourceforge.net bug submission system</a>. Please include detailed description
and all relevant source files.
</p>


<hr>
<address>Dawid Kurzyniec,
<A HREF="mailto:dawidk@mathcs.emory.edu" target="_top">dawidk@mathcs.emory.edu</A>
</address>

</body>
</html>












